// ====== DOM Elements ======
const overlay = document.getElementById("reviewsOverlay");
const popup = document.getElementById("reviewsPopup");
const toggleBtn = document.getElementById("toggleReviews");
const closeBtn = document.getElementById("closePopup");
const reviewForm = document.getElementById("reviewForm");
const reviewFormCard = document.getElementById("reviewFormCard");
const cancelFormBtn = document.getElementById("cancelFormBtn");
const showFormBtn = document.getElementById("showFormBtn");
const showFormBtnInside = document.getElementById("showFormBtnInside");

// Main elements outside modal
const avgRatingEl = document.getElementById("avgRating");
const avgStarsEl = document.getElementById("avgStars");
const satisfiedCountEl = document.getElementById("satisfiedCount");
const totalReviewsEl = document.getElementById("totalReviews");
const successCountEl = document.getElementById("successCount");
const successCountErrorMainEl = document.getElementById("successCountErrorMain");

// Elements inside modal
const avgRatingModalEl = document.getElementById("avgRatingModal");
const avgStarsModalEl = document.getElementById("avgStarsModal");
const satisfiedCountModalEl = document.getElementById("satisfiedCountModal");
const totalReviewsModalEl = document.getElementById("totalReviewsModal");
const successCountModalEl = document.getElementById("successCountModal");
const successCountErrorEl = document.getElementById("successCountError");

// Reviews containers
const reviewsContainer = document.getElementById("reviewsContainer");
const mainReviewsContainer = document.getElementById("mainReviewsContainer");

// Supabase configuration
const SUPABASE_URL = "https://rtzkgoxsthhocibehzay.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0emtnb3hzdGhob2NpYmVoemF5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM5MTk5NzksImV4cCI6MjA2OTQ5NTk3OX0.bj5fSRTLXze1h0kkSveSZsEyfrkRAtoXvqeWtUikD7o";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ====== Utility Functions ======
function escapeHtml(text) {
  const map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };
  return text.replace(/[&<>"']/g, m => map[m]);
}

function generateStars(rating) {
  const fullStars = '‚òÖ'.repeat(rating);
  const emptyStars = '‚òÜ'.repeat(5 - rating);
  return fullStars + emptyStars;
}

function calculateAverageRating(reviews) {
  if (!reviews || reviews.length === 0) return 0;

  const sum = reviews.reduce((acc, review) => acc + (review.stars || 0), 0);
  return (sum / reviews.length).toFixed(1);
}

// ====== Load Functions ======
// Load users count and transactions count
async function loadUsersCount() {
  try {
    console.log("üîÑ Loading users count...");

    // Get users count
    const { count, error } = await client
      .from("users")
      .select("*", { count: 'exact', head: true });

    if (error) {
      console.error("‚ùå Error fetching users count:", error);
      return;
    }

    console.log("‚úÖ Users count fetched:", count);
    const total = count || 0;
    const satisfied = total > 0 ? total : "0";

    // Update outside modal
    satisfiedCountEl.textContent = satisfied;

    // Update inside modal
    satisfiedCountModalEl.textContent = satisfied;

    // Get completed transactions count
    try {
      console.log("üîÑ Loading completed transactions count...");

      // Get completed recharge transactions
      const { count: rechargeCount, error: rechargeError } = await client
        .from("recharge_transactions")
        .select("*", { count: 'exact', head: true })
        .eq("status", "ÿ™ŸÖ");

      // Get completed supply transactions
      const { count: supplyCount, error: supplyError } = await client
        .from("supply_transactions")
        .select("*", { count: 'exact', head: true })
        .eq("status", "ÿ™ŸÖ");

      // Check for errors
      const successError = rechargeError || supplyError;

      if (successError) {
        console.error("‚ùå Error fetching completed transactions:", successError);
        if (rechargeError) {
          console.error("‚ùå Error in recharge transactions:", rechargeError);
        }
        if (supplyError) {
          console.error("‚ùå Error in supply transactions:", supplyError);
        }

        // Use default values in case of error
        successCountEl.textContent = "0";
        successCountModalEl.textContent = "0";
        // Show error message
        successCountErrorEl.style.display = "block";
        successCountErrorMainEl.style.display = "block";
      } else {
        console.log("‚úÖ Completed recharge transactions:", rechargeCount);
        console.log("‚úÖ Completed supply transactions:", supplyCount);

        // Sum transactions from both tables
        const successTotal = (rechargeCount || 0) + (supplyCount || 0);
        console.log("‚úÖ Total completed transactions:", successTotal);

        // Update successful operations count outside modal
        successCountEl.textContent = successTotal;

        // Update successful operations count inside modal
        successCountModalEl.textContent = successTotal;

        // Hide error message
        successCountErrorEl.style.display = "none";
        successCountErrorMainEl.style.display = "none";
      }
    } catch (err) {
      console.error("‚ùå Exception when fetching completed transactions:", err);
      // Use default values in case of exception
      successCountEl.textContent = "0";
      successCountModalEl.textContent = "0";
      // Show error message
      successCountErrorEl.style.display = "block";
      successCountErrorMainEl.style.display = "block";
    }
  } catch (err) {
    console.error("‚ö° Unexpected exception:", err);
  }
}

// Update reviews count
async function updateReviewsCount() {
  try {
    console.log("üîÑ Updating reviews count...");

    const { count, error } = await client
      .from("reviews")
      .select("*", { count: 'exact', head: true });

    if (error) {
      console.error("‚ùå Error fetching reviews count:", error);
      return;
    }

    console.log("‚úÖ Reviews count updated:", count);

    const reviewCount = count || 0;
    console.log("üîÑ Updating reviews count in updateReviewsCount:", reviewCount);

    if (totalReviewsEl) {
      totalReviewsEl.textContent = reviewCount;
      console.log("‚úÖ Reviews count updated on main page from updateReviewsCount");
    }

    if (totalReviewsModalEl) {
      totalReviewsModalEl.textContent = reviewCount;
      console.log("‚úÖ Reviews count updated in modal from updateReviewsCount");
    }
  } catch (err) {
    console.error("‚ö° Unexpected exception when updating reviews count:", err);
  }
}

// Load and display reviews
async function loadReviews() {
  try {
    console.log("üîÑ Loading reviews...");

    // Check if required variables exist
    if (!client) {
      console.error("‚ùå Supabase client not initialized");
      return;
    }

    if (!reviewsContainer) {
      console.error("‚ùå Reviews container element not found");
      return;
    }

    // Use cached reviews if available
    if (window.cachedReviewsHtml) {
      console.log("‚úÖ Using cached reviews");
      // ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™ ŸÅŸÇÿ∑ ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© ŸàŸÑŸäÿ≥ ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
      reviewsContainer.innerHTML = window.cachedReviewsHtml;
      return;
    }

    const { data: reviews, error } = await client
      .from("reviews")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      console.error("‚ùå Error fetching reviews:", error);
      reviewsContainer.innerHTML = 
        `<p style="color:red; text-align:center">üö® Error fetching reviews: ${error.message}</p>`;
      return;
    }

    console.log("‚úÖ Reviews fetched:", reviews);

    // Update reviews count
    const reviewCount = reviews ? reviews.length : 0;
    if (totalReviewsEl) totalReviewsEl.textContent = reviewCount;
    if (totalReviewsModalEl) totalReviewsModalEl.textContent = reviewCount;

    // Calculate average rating
    const avgRating = calculateAverageRating(reviews);
    if (avgRatingEl) avgRatingEl.textContent = avgRating;
    if (avgRatingModalEl) avgRatingModalEl.textContent = avgRating;

    // Update stars display
    if (avgStarsEl) avgStarsEl.textContent = generateStars(Math.round(avgRating));
    if (avgStarsModalEl) avgStarsModalEl.textContent = generateStars(Math.round(avgRating));

    // Display reviews
    if (!reviews || reviews.length === 0) {
      reviewsContainer.innerHTML = 
        `<p style="text-align:center; color:#888; padding:20px">No reviews yet</p>`;
      return;
    }

    let reviewsHtml = "";
    reviews.forEach((review, index) => {
      console.log(`üìù Processing review ${index + 1}:`, review);

      // Check for required data
      const name = review.name || "Anonymous";
      const location = review.location || "Unspecified";
      const stars = review.stars ? generateStars(review.stars) : "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ";
      const comment = review.comment || "No comment";

      reviewsHtml += `
        <div class="review-card">
          <div class="review-row-1">
            <div class="reviewer-info">
              <div class="reviewer-avatar">${name.charAt(0).toUpperCase()}</div>
              <div class="reviewer-name" onclick="handleNameClick('${escapeHtml(name)}', this)" style="cursor: pointer;" data-clicks="0">${escapeHtml(name)}</div>
            </div>
            <div class="review-stars">${stars}</div>
          </div>
          <div class="review-row-2">
            <div class="reviewer-location">üìç ${escapeHtml(location)}</div>
            <div class="review-date">üïí ${new Date(review.created_at).toLocaleDateString('ar-EG')}</div>
          </div>
          <div class="review-row-3">
            <div class="review-text">${escapeHtml(comment)}</div>
          </div>
        </div>
      `;
    });

    console.log("‚úÖ Reviews HTML prepared");
    reviewsContainer.innerHTML = reviewsHtml;

    // Cache reviews for later use
    window.cachedReviewsHtml = reviewsHtml;
    console.log("‚úÖ Reviews cached");

    // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ŸÑÿ¨ŸÖŸäÿπ ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿπŸÖŸÑÿßÿ° ÿ®ÿπÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™
    setTimeout(() => {
      const reviewerNames = document.querySelectorAll('.reviewer-name');
      reviewerNames.forEach(nameElement => {
        // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑÿπŸÜÿµÿ± ŸÑÿØŸäŸá ÿßŸÑÿÆÿßÿµŸäÿ© data-clicks
        if (!nameElement.getAttribute('data-clicks')) {
          nameElement.setAttribute('data-clicks', '0');
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπ ÿßŸÑÿ≠ÿØÿ´ ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØŸãÿß ÿ®ÿßŸÑŸÅÿπŸÑ
        if (!nameElement.hasAttribute('data-listener')) {
          nameElement.addEventListener('click', function() {
            handleNameClick(this.textContent, this);
          });
          nameElement.setAttribute('data-listener', 'true');
        }
      });
      console.log("‚úÖ Added click listeners to all reviewer names");
    }, 100);

    // ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™ ÿ≥ÿ™ÿ∏Ÿáÿ± ŸÅŸÇÿ∑ ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© ŸàŸÑŸäÿ≥ ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
    // ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™ ŸÅŸä ÿßŸÑÿ≠ÿßŸàŸäÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
  } catch (err) {
    console.error("‚ö° Unexpected exception when fetching reviews:", err);
    reviewsContainer.innerHTML = 
      `<p style="color:red; text-align:center">üö® Unexpected error: ${err.message}</p>`;
  }
}

// ====== Event Listeners ======
// Open and close modal
toggleBtn.addEventListener("click", () => {
  overlay.style.display = "flex";
  setTimeout(() => popup.classList.add("show"), 50);
  loadUsersCount();

  // Update reviews count with short delay
  setTimeout(() => {
    console.log("üîÑ Updating reviews count when opening modal");
    updateReviewsCount();
  }, 300);

  // Load reviews with longer delay
  setTimeout(() => {
    console.log("üîÑ Loading reviews when opening modal");
    loadReviews();
  }, 500);
});

closeBtn.addEventListener("click", () => {
  popup.classList.remove("show");
  setTimeout(() => overlay.style.display = "none", 200);
});

// Show review form
showFormBtn.addEventListener("click", () => { 
  reviewFormCard.style.display = "block"; 
  window.scrollTo({top: reviewFormCard.offsetTop, behavior: "smooth"}); 
});

showFormBtnInside.addEventListener("click", () => {
  popup.classList.remove("show");
  setTimeout(() => overlay.style.display = "none", 200);
  reviewFormCard.style.display = "block";
  window.scrollTo({top: reviewFormCard.offsetTop, behavior: "smooth"});
});

// Submit review
reviewForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const location = document.getElementById("location").value.trim();
  const rating = parseInt(document.getElementById("rating").value);
  const comment = document.getElementById("comment").value.trim();

  if (!name || !location || !rating || !comment) { 
    alert("Please fill all fields"); 
    return; 
  }

  const { error } = await client.from("reviews").insert([{ 
    name, 
    location, 
    stars: rating, 
    comment 
  }]);

  if (error) { 
    console.error("Insert error:", error); 
    alert("‚ùå Error saving review: " + error.message); 
    return; 
  }

  alert("‚úÖ Review submitted successfully");
  reviewForm.reset();
  reviewFormCard.style.display = "none";

  // Reload data
  loadUsersCount();

  // Clear cached reviews
  window.cachedReviewsHtml = null;
  console.log("‚úÖ Cached reviews cleared");

  // Update reviews count after adding new review with short delay
  setTimeout(() => {
    console.log("üîÑ Updating reviews count after adding new review");
    updateReviewsCount();
  }, 500);

  // Reload reviews after adding new review with longer delay
  setTimeout(() => {
    console.log("üîÑ Reloading reviews after adding new review");
    loadReviews();
  }, 700);
});

// Hide form when cancel button is clicked
cancelFormBtn.addEventListener("click", () => {
  reviewFormCard.style.display = "none";
  reviewForm.reset();
});

// ÿØÿßŸÑÿ© ŸÑŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ
function handleNameClick(name, element) {
  // ÿ≤ŸäÿßÿØÿ© ÿπÿØÿØ ÿßŸÑŸÜŸÇÿ±ÿßÿ™
  let clicks = parseInt(element.getAttribute('data-clicks')) + 1;
  element.setAttribute('data-clicks', clicks);

  // ÿ™ÿ∫ŸäŸäÿ± ŸÑŸàŸÜ ÿßŸÑÿßÿ≥ŸÖ ÿπŸÜÿØ ŸÉŸÑ ŸÜŸÇÿ±ÿ©
  element.style.color = clicks >= 3 ? '#ff5100' : '';

  console.log(`üîç Clicked on ${name}: ${clicks} times`);

  // ÿπŸÜÿØ ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ 5 ŸÜŸÇÿ±ÿßÿ™
  if (clicks >= 5) {
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿπÿØÿØ ÿßŸÑŸÜŸÇÿ±ÿßÿ™
    element.setAttribute('data-clicks', 0);
    element.style.color = '';

    // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿßŸÑÿ≠ÿßŸÑŸä
    const reviewCard = element.closest('.review-card');

    if (reviewCard) {
      // ŸÜÿ≥ÿÆ ÿßŸÑÿ™ÿπŸÑŸäŸÇ
      const reviewClone = reviewCard.cloneNode(true);

      // ÿ•ÿ∂ÿßŸÅÿ© ÿ≤ÿ± ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿßŸÑŸÖÿ´ÿ®ÿ™ (Ÿäÿ∏Ÿáÿ± ŸÅŸÇÿ∑ ŸÑŸÑŸÖÿØŸäÿ±)
      const removePinButton = document.createElement("button");
      removePinButton.className = "btn ghost";
      removePinButton.innerHTML = '<i class="fas fa-unlink"></i> ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™';
      removePinButton.style.marginTop = "10px";
      removePinButton.style.display = "none"; // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ≤ÿ± ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäŸãÿß

      // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ≤ÿ± ŸÅŸÇÿ∑ ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿØŸäÿ± 5 ŸÖÿ±ÿßÿ™
      removePinButton.addEventListener("click", function() {
        // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿßŸÑŸÖÿ´ÿ®ÿ™
        const pinnedReview = document.querySelector(".pinned-review");
        if (pinnedReview) {
          pinnedReview.remove();
        }
        // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ£ŸÉŸäÿØ
        const message = document.createElement("div");
        message.className = "success-message";
        message.textContent = "ÿ™ŸÖ ÿ•ÿ≤ÿßŸÑÿ© ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿ®ŸÜÿ¨ÿßÿ≠";
        message.style.textAlign = "center";
        message.style.padding = "10px";
        message.style.marginTop = "10px";
        message.style.backgroundColor = "rgba(76, 175, 80, 0.2)";
        message.style.borderRadius = "5px";
        reviewsContainer.insertBefore(message, reviewsContainer.firstChild);

        // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
        setTimeout(() => {
          message.remove();
        }, 3000);
      });

      // ÿ•ÿ∏Ÿáÿßÿ± ÿ≤ÿ± ÿßŸÑÿ•ÿ≤ÿßŸÑÿ© ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿßŸÑŸÖÿ´ÿ®ÿ™ 3 ŸÖÿ±ÿßÿ™
      reviewClone.addEventListener("click", function(e) {
        // ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÜŸÇÿ± ŸÑŸÖ ŸäŸÉŸÜ ÿπŸÑŸâ ÿ≤ÿ± ÿßŸÑÿ•ÿ≤ÿßŸÑÿ© ÿ®ÿßŸÑŸÅÿπŸÑ
        if (e.target.closest('.btn')) return;

        let pinClicks = parseInt(this.getAttribute('data-pin-clicks') || 0) + 1;
        this.setAttribute('data-pin-clicks', pinClicks);

        if (pinClicks >= 3 && removePinButton.style.display === "none") {
          removePinButton.style.display = "block";
          this.setAttribute('data-pin-clicks', 0);

          // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ£ŸÉŸäÿØ
          const message = document.createElement("div");
          message.className = "info-message";
          message.textContent = "ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ¢ŸÜ ÿ•ÿ≤ÿßŸÑÿ© ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ÿπŸÑŸäŸÇ";
          message.style.textAlign = "center";
          message.style.padding = "10px";
          message.style.marginTop = "10px";
          message.style.backgroundColor = "rgba(33, 150, 243, 0.2)";
          message.style.borderRadius = "5px";

          // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ±ÿ≥ÿßŸÑÿ© ÿ≥ÿßÿ®ŸÇÿ© Ÿàÿ•ÿ≤ÿßŸÑÿ™Ÿáÿß
          const existingMessage = this.parentNode.querySelector('.info-message');
          if (existingMessage) {
            existingMessage.remove();
          }

          reviewsContainer.insertBefore(message, this.nextSibling);

          // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
          setTimeout(() => {
            if (message.parentNode) {
              message.remove();
            }
          }, 3000);
        }
      });

      reviewClone.appendChild(removePinButton);
      reviewClone.classList.add("pinned-review");

      // ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä ÿ™ÿπŸÑŸäŸÇ ŸÖÿ´ÿ®ÿ™ ÿ≥ÿßÿ®ŸÇ
      const existingPinnedReview = document.querySelector(".pinned-review");
      if (existingPinnedReview) {
        existingPinnedReview.remove();
      }

      // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÇ ÿßŸÑŸÖÿ´ÿ®ÿ™ ŸÅŸä ÿßŸÑÿ£ÿπŸÑŸâ
      reviewsContainer.insertBefore(reviewClone, reviewsContainer.firstChild);

      // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ£ŸÉŸäÿØ
      const message = document.createElement("div");
      message.className = "success-message";
      message.textContent = "ÿ™ŸÖ ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ÿπŸÑŸäŸÇ ŸÅŸä ÿßŸÑÿ£ÿπŸÑŸâ ÿ®ŸÜÿ¨ÿßÿ≠";
      message.style.textAlign = "center";
      message.style.padding = "10px";
      message.style.marginTop = "10px";
      message.style.backgroundColor = "rgba(76, 175, 80, 0.2)";
      message.style.borderRadius = "5px";
      reviewsContainer.insertBefore(message, reviewClone.nextSibling);

      // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
      setTimeout(() => {
        message.remove();
      }, 3000);
    }
  }
}

// Load data when page loads
window.addEventListener("load", () => {
  loadUsersCount();
  loadReviews();

  // Show modal automatically after a delay
  setTimeout(() => {
    overlay.style.display = "flex";
    setTimeout(() => popup.classList.add("show"), 50);
  }, 1000); // Wait 1 second before showing modal
});
